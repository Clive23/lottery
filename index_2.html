<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lottery</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <link rel="stylesheet" href="/public/styles/reset.css" />
    <link rel="stylesheet" href="/public/styles/style.css" />
  </head>
  <body>
    <div class="coffeti-1"></div>
    <div class="coffeti-2"></div>
    <div id="tokenomy-logo">
      <img src="/public/images/logo_tokenomy_blue_new.svg" width="250" />
    </div>
    <main>
      <div class="left" id="left">
        <img id="current-prize-image" width="400" />
        <img src="public/images/floor.png" width="460" />
      </div>
      <div class="right">
        <div id="festival-title">
          <img src="/public/images/Festival_Tokenomy_Earn.png" width="500" />
        </div>
        <div class="box">
          <div id="main-box">
            <div class="winner-container">
              <h1
                class="animate__animated animate__slower"
                id="winner-name"
              ></h1>
            </div>
            <button onclick="exec()" id="button-start">Roll</button>
            <button onclick="exec()" id="button-stop">Stop</button>
            <button onclick="exec()" id="button-next">Next round</button>
            <button onclick="goToWinnerList()" id="button-showWinners">
              List of Winners
            </button>
          </div>
          <div id="all-winners">
            <h1>Winners</h1>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

      <script>
        let confettiSecond = confetti;
      </script>

      <script src="https://cdn.jsdelivr.net/gh/mathusummut/confetti.js/confetti.min.js"></script>

      <script>
        Array.prototype.random = function () {
          return this[Math.floor(Math.random() * this.length)];
        };
        const delay = (ms) => new Promise((res) => setTimeout(res, ms));
      </script>

      <script>
        let winner;
        let names = [
          { name: "Kurniady W." },
          { name: "Virgo E. J." },
          { name: "Hendri" },
          { name: "Daniel" },
          { name: "Rinny" },
          { name: "Yudi" },
          { name: "I.R. Johan" },
          { name: "M. Septian" },
          { name: "A. Irvan" },
          { name: "Ardy C." },
          { name: "Herman" },
          { name: "Poppy C. R." },
          { name: "Anna B." },
          { name: "Adolfus" },
          { name: "A. Saepul" },
          { name: "Angelisa B." },
          { name: "S. Elim" },
          { name: "M. Ikhwan" },
          { name: "D. Dyandoko" },
          { name: "Edwin" },
          { name: "I. G. Balik" },
          { name: "Mirah P." },
          { name: "Robert" },
          { name: "F. Chandra" },
          { name: "Andreas" },
          { name: "Aryo" },
          { name: "Dimas W." },
          { name: "Yanto" },
          { name: "Catur W." },
        ];

        let namesPlaceholders = [
          ...names,
          {
            name: "Charlie",
          },
          {
            name: "Angel",
          },
          {
            name: "Rio",
          },
          {
            name: "Juta",
          },
          {
            name: "Ivannov E. S.",
          },
          {
            name: "Oey M. W.",
          },
          {
            name: "Abdul K. R.",
          },
          {
            name: "Yoselfa S.",
          },
          {
            name: "Candrika R. M.",
          },
          {
            name: "Danu K.",
          },
          {
            name: "Adam A.",
          },
          {
            name: "Ade S.",
          },
          {
            name: "Konly A.",
          },
          {
            name: "Ilhamullah",
          },
          {
            name: "Chandrago",
          },
          {
            name: "Then B. H.",
          },
          {
            name: "Erik F.",
          },
          {
            name: "Gunov G.",
          },
          {
            name: "Eko K.",
          },
          {
            name: "Restu A.",
          },
          {
            name: "Andri A.",
          },
          {
            name: "Hilman S.",
          },
          {
            name: "Gradi D.",
          },
          {
            name: "Yohanes E. S.",
          },
          {
            name: "Eko H. G.",
          },
          {
            name: "Barrun A.",
          },
          {
            name: "Jonathan B. B.",
          },
          {
            name: "Jhony G.",
          },
          {
            name: "Agustina S.",
          },
          {
            name: "Yudi G.",
          },
          {
            name: "Jimmy M.",
          },
          {
            name: "Ryan A. R.",
          },
          {
            name: "Steven",
          },
          {
            name: "Muhammad K.",
          },
          {
            name: "So A. S.",
          },
          {
            name: "Jovian H.",
          },
          {
            name: "Ricky S.",
          },
          {
            name: "Putu S.",
          },
          {
            name: "Daffa S. E.",
          },
          {
            name: "Prinanda D. S.",
          },
          {
            name: "Arfik I. W.",
          },
          {
            name: "Kerry S.",
          },
          {
            name: "Leonard A.",
          },
          {
            name: "Abdul H. A.",
          },
          {
            name: "Eggy S.",
          },
          {
            name: "Jubri",
          },
          {
            name: "Shelli N.",
          },
          {
            name: "Alwyn A.",
          },
          {
            name: "Kevin H.",
          },
          {
            name: "Ahmad H.",
          },
          {
            name: "Affan M. H.",
          },
          {
            name: "Irfan T.",
          },
          {
            name: "Bagus W.",
          },
          {
            name: "Ari I. S.",
          },
          {
            name: "Zainal A.",
          },
          {
            name: "Sumardi",
          },
          {
            name: "Ketut E. S.",
          },
          {
            name: "Eric J. S.",
          },
          {
            name: "Handoyo S.",
          },
          {
            name: "Henry J.",
          },
          {
            name: "Vanny",
          },
          {
            name: "Natalia S.",
          },
          {
            name: "Wiryo H.",
          },
        ];

        const winnerNameEl = document.getElementById("winner-name");
        const buttonStartEl = document.getElementById("button-start");
        const buttonStopEl = document.getElementById("button-stop");
        const buttonNextEl = document.getElementById("button-next");
        const buttonShowWinnersEl =
          document.getElementById("button-showWinners");
        const allWinnersEl = document.getElementById("all-winners");
        const mainBoxEl = document.getElementById("main-box");
        const currentPrizeImage = document.getElementById(
          "current-prize-image"
        );

        const leftEl = document.getElementById("left");

        let round = 1;
        let roundWinners = [
          { name: "Hendri", email: "he*****ber@gmail.com" },
          { name: "Daniel", email: "gu*****el@gmail.com" },
          { name: "Dimas W", email: "as*****snu@gmail.com" },
          { name: "Edwin", email: "eru*****t69@yahoo.co.id" },
          { name: "S. Elim", email: "leo*****se@gmail.com" },
          { name: "Kurniady W.", email: "ku*****rno@gmail.com" },
        ];

        let roundPrizes = [
          { name: "Samsung Smart TV", logo: "/public/images/Prizes/tv.png" },
          {
            name: "Harman Kardon Onyx 5",
            logo: "/public/images/Prizes/speaker.png",
          },
          { name: "Ipad 9 2021", logo: "/public/images/Prizes/ipad.png" },
          {
            name: "Headphone Sony",
            logo: "/public/images/Prizes/headphone.png",
          },
          { name: "Smartwatch Amazfit", logo: "/public/images/Prizes/jam.png" },
          { name: "New Honda Genio", logo: "/public/images/Prizes/motor.png" },
        ];

        let globalId;
        let status = "idle"; // stop / pending / started / finished

        window.onload = function () {
          // set round
          winnerNameEl.innerHTML = `<span style="font-size: 2rem">Winner of ${
            roundPrizes[round - 1].name
          }<span>`;
          currentPrizeImage.setAttribute("src", roundPrizes[round - 1].logo);
        };

        function showWinners() {
          mainBoxEl.style.display = "none";
          allWinnersEl.style.display = "flex";

          for (let i = roundPrizes.length - 1; i >= 0; i--) {
            allWinnersEl.insertAdjacentHTML(
              "beforeend",
              `
                    <div>
                      <img src="${roundPrizes[i].logo}" />
                      <div style="display: flex; flex-direction: column;">
                        <p style="font-weight: bold;">${roundWinners[i].name}</p>
                        <p style="font-size: 15px; margin-top: 5px;">${roundWinners[i].email}</p>
                      </div>
                    </div>
                `
            );
          }
        }

        function duar() {
          var duration = 600 * 1000;
          var animationEnd = Date.now() + duration;
          var skew = 1;

          var end = Date.now() + 600 * 1000;
          var colors = ["#1EAFED", "#ffffff"];

          function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
          }

          (function frame() {
            var timeLeft = animationEnd - Date.now();
            var ticks = Math.max(200, 500 * (timeLeft / duration));
            skew = Math.max(0.8, skew - 0.001);

            confettiSecond({
              particleCount: 1,
              startVelocity: 0,
              ticks: ticks,
              origin: {
                x: Math.random(),
                y: Math.random() * skew - 0.2,
              },
              colors: colors,
              gravity: randomInRange(0.4, 0.6),
              scalar: randomInRange(0.4, 1),
              drift: randomInRange(-0.4, 0.4),
            });

            if (timeLeft > 0) {
              requestAnimationFrame(frame);
            }
          })();

          (function frame() {
            confettiSecond({
              particleCount: 2,
              angle: 60,
              spread: 55,
              origin: { x: 0 },
              colors: colors,
            });
            confettiSecond({
              particleCount: 2,
              angle: 120,
              spread: 55,
              origin: { x: 1 },
              colors: colors,
            });

            if (Date.now() < end) {
              requestAnimationFrame(frame);
            }
          })();
        }

        // next round
        function nextRound() {
          if (status === "finished") {
            return;
          }
          winnerNameEl.innerHTML = `<span style="font-size: 2rem">Winner of ${roundPrizes[round].name}</span>`;
          confettiSecond.reset();
          status = "idle";
          round += 1;
          currentPrizeImage.setAttribute("src", roundPrizes[round - 1].logo);
        }

        function stop() {
          if (round === roundPrizes.length) {
            status = "finished";
            buttonStartEl.style.display = "none";
            buttonStopEl.style.display = "none";
            buttonNextEl.style.display = "none";
          } else {
            status = "stopped";
          }

          winnerNameEl.classList.add("animate__bounceIn");
          clearInterval(globalId);
          winnerNameEl.innerText = roundWinners[round - 1].name;
          names = names.filter((n) => n.name !== winner);
        }

        function start() {
          status = "started";
          winnerNameEl.classList.remove("animate__bounceIn");
          if (round === roundPrizes.length + 1) {
            showConfetti();
            stop();
            status = "finished";
            return;
          }

          globalId = setInterval(() => {
            winner = names.random().name;
            let winnerNamePlaceholder = namesPlaceholders.random();
            winnerNameEl.innerText = winnerNamePlaceholder.name;
          }, 20);
        }

        function showConfetti() {
          confettiSecond({
            particleCount: 300,
            startVelocity: 40,
            spread: 200,
            gravity: 0.7,
            origin: {
              y: 0.6,
            },
          });

          showLeftRightConfetti();
        }

        function showLeftRightConfetti(seconds = 3) {
          confettiSecond({
            particleCount: 250,
            angle: 60,
            startVelocity: 30,
            spread: 135,
            origin: { x: 0 },
          });
          confettiSecond({
            particleCount: 250,
            startVelocity: 30,
            angle: 120,
            spread: 135,
            origin: { x: 1 },
          });
        }

        function checkStatus() {
          switch (status) {
            case "idle":
              buttonStartEl.style.display = "block";
              buttonStopEl.style.display = "none";
              buttonNextEl.style.display = "none";
              break;
            case "started":
              buttonStartEl.style.display = "none";
              buttonStopEl.style.display = "block";
              buttonNextEl.style.display = "none";
              break;
            case "stopped":
              buttonStartEl.style.display = "none";
              buttonStopEl.style.display = "none";
              buttonNextEl.style.display = "block";
              break;

            case "finished":
              buttonStartEl.style.display = "none";
              buttonStopEl.style.display = "none";
              buttonNextEl.style.display = "none";
              buttonShowWinnersEl.style.display = "block";
            default:
              break;
          }
        }

        function exec() {
          switch (status) {
            case "idle":
              start();
              checkStatus();
              break;
            case "started":
              stop();
              checkStatus();
              showConfetti();
              break;
            case "stopped":
              nextRound();
              checkStatus();
              break;
            case "finished":
              nextRound();
              checkStatus();
            default:
              checkStatus();
              break;
          }
        }

        function goToWinnerList() {
          window.location.href = window.location.origin + "/pemenang.html";
        }
      </script>
    </footer>
  </body>
</html>
